// bml => bookmarklet
// Below single line code is provided by ChatGPT for working function in test harness HTML.
// Multi line copy paste of that function into Chrome bookmarklet gave some encoding issues and
// IFIRC, unexpected end of code error.
// Paste below code excluding these comment lines into URL field of Chrome bookmark
javascript:(function(){const sel=window.getSelection().toString().trim();if(!sel){alert("Select the <h3> HTML or heading text first.");return;}const MAX_ID_LEN=20,slugify=t=>{const s=t.toLowerCase().replace(/&/g,"and").replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"");return s.substring(0,MAX_ID_LEN).replace(/-$/,"")};let text="",id="",html="";if(/^<h3\b[\s\S]*<\/h3>$/.test(sel)){const o=sel.match(/<h3\b[^>]*>/i),m=sel.match(/<h3\b[^>]*>([\s\S]*?)<\/h3>/i);if(!o||!m){alert("Could not extract <h3> content.");return;}let openTag=o[0];text=m[1].replace(/<a\b[^>]*>.*?<\/a>/gi,"").replace(/#$/,"").trim();const idMatch=openTag.match(/id\s*=\s*["']([^"']+)["']/i);id=idMatch?idMatch[1]:slugify(text);if(!idMatch){openTag=openTag.replace(/^<h3\b/i,`<h3 id="${id}"`)}html=`${openTag}\n  ${text} <a href="#${id}">#</a>\n</h3>`}else{text=sel;id=slugify(text);html=`<h3 id="${id}">\n  ${text} <a href="#${id}">#</a>\n</h3>`}navigator.clipboard.writeText(html).then(()=>{console.log("Anchor <h3> HTML copied to clipboard.")})})();

